<Window x:Class="Protes.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Protes"
        Title="[Protes] Settings" 
        Height="615" Width="500"
        MinWidth="500"
        MinHeight="615"
        FontFamily="Segoe UI" 
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Reusable style for action buttons -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="Height" Value="26"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="1">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Base button style for consistent height -->
        <Style x:Key="ConsistentButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Padding" Value="10,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl x:Name="SettingsTabControl" Grid.Row="0" Margin="0,0,0,5">

            <!-- LOCAL DATABASE TAB -->
            <TabItem Header="Local Database">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Available Databases (now fills space and includes buttons inside) -->
                        <GroupBox Grid.Row="0" Header="Available Databases" Margin="0,0,0,5">
                            <Grid Margin="0,5,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <ListBox x:Name="LocalDbList" 
                                         SelectionChanged="LocalDbList_SelectionChanged"
                                         VerticalContentAlignment="Stretch">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding FullPath}" FontStyle="Italic" FontSize="10" Foreground="Gray"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!-- Action buttons inside Available Databases box -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,5,0,0">
                                    <Button x:Name="LoadSelectedButton"
                                            Content=" Load Selected "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="LoadSelectedButton_Click"/>
                                    <Button x:Name="RemoveFromListButton"
                                            Content=" Remove from List "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="RemoveFromListButton_Click"/>
                                    <Button x:Name="DeleteDatabaseButton"
                                            Content=" Delete Database "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="DeleteDatabaseButton_Click"/>
                                </StackPanel>
                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock 
                                        Text="Note: Database's stored inside the default folder cannot be removed from the list." 
                                        FontStyle="Italic" 
                                        Foreground="Gray"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Current Database with buttons inside -->
                        <GroupBox Grid.Row="1" Header="Current Database" Margin="0,0,0,5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Name="CurrentDbPathText" 
                                           Text="C:\Users\...\notes.db"
                                           TextWrapping="Wrap"
                                           FontStyle="Italic"
                                           Margin="0,5,0,5"/>
                                <StackPanel Grid.Row="1" Orientation="Horizontal">
                                    <Button x:Name="NewDbButton" Content="New…" Style="{StaticResource ConsistentButtonStyle}" Margin="0,0,10,0" Click="NewDbButton_Click"/>
                                    <Button x:Name="ExportDbButton" Content="Export…" Style="{StaticResource ConsistentButtonStyle}" Margin="0,0,10,0" Click="ExportDbButton_Click"/>
                                    <Button x:Name="ImportDbButton" Content="Import…" Style="{StaticResource ConsistentButtonStyle}" Click="ImportDbButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Default Database Folder (now at bottom) -->
                        <GroupBox Grid.Row="2" Header="Default Database Folder" Margin="0,0,0,5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Name="DefaultDbFolderText"
                                           Text="C:\Users\...\AppData\Roaming\Protes"
                                           TextWrapping="Wrap"
                                           FontStyle="Italic"
                                           Margin="0,5,0,5"/>
                                <Button Grid.Row="1"
                                        Content="Change Folder…"
                                        Style="{StaticResource ConsistentButtonStyle}"
                                        HorizontalAlignment="Left"
                                        Click="ChangeDefaultFolderButton_Click"/>
                            </Grid>
                        </GroupBox>

                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- EXTERNAL DATABASE TAB -->
            <TabItem Header="External Database">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- External Connections List -->
                        <GroupBox Grid.Row="0" Header="External Connections" Margin="0,0,0,5">
                            <Grid Margin="0,5,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <ListBox x:Name="ExternalConnectionsList"
                             SelectionChanged="ExternalConnectionsList_SelectionChanged"
                             VerticalContentAlignment="Stretch">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding DisplayName}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding DisplaySubtitle}" FontSize="10" Foreground="Gray"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,5,0,0">
                                    <Button x:Name="AddConnectionButton"
                                Content="Add..."
                                Style="{StaticResource ConsistentButtonStyle}"
                                Margin="0,0,5,0"
                                Click="AddConnectionButton_Click"/>
                                    <Button x:Name="EditConnectionButton"
                                Content="Edit..."
                                Style="{StaticResource ConsistentButtonStyle}"
                                Margin="0,0,5,0"
                                Click="EditConnectionButton_Click"
                                IsEnabled="False"/>
                                    <Button x:Name="RemoveConnectionButton"
                                Content="Remove..."
                                Style="{StaticResource ConsistentButtonStyle}"
                                Margin="0,0,5,0"
                                Click="RemoveConnectionButton_Click"
                                IsEnabled="False"/>
                                    <Button x:Name="ConnectNowButton"
                                Content="Connect..."
                                Style="{StaticResource ConsistentButtonStyle}"
                                Margin="0,0,5,0"
                                Click="ConnectNowButton_Click"
                                IsEnabled="False"/>
                                    <Button x:Name="SetDefaultButton"
                                Content="Set Default"
                                Style="{StaticResource ConsistentButtonStyle}"
                                Margin="0,0,5,0"
                                Click="SetDefaultButton_Click"
                                IsEnabled="False"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- ✅ Current Default External Connection -->
                        <GroupBox Grid.Row="1" Header="Current External Default Database" Margin="0,0,0,5">
                            <TextBlock x:Name="CurrentDefaultExternalText"
               Text="(No external connection configured)"
               FontStyle="Italic"
               TextWrapping="Wrap"
               Margin="0,5,0,5"/>
                        </GroupBox>

                        <GroupBox Grid.Row="2" Header="Database Table Requirements" Margin="0,0,0,0">
                            <StackPanel>
                                <TextBlock Text="External databases need to be setup with a Notes table before connecting."
                   FontStyle="Italic"
                   Foreground="Gray"
                   Margin="0,5,0,0"/>
                                <Button x:Name="RequirementsButton"
                Content="Info..."
                HorizontalAlignment="Left"
                Margin="0,5,0,0"
                Padding="10,5"
                Click="RequirementsButton_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- APPLICATION TAB -->
            <TabItem Header="Application">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Application Settings -->
                        <GroupBox Grid.Row="0" Header="Application Settings" Margin="0,0,0,5">
                            <StackPanel>
                                <CheckBox x:Name="LaunchOnStartupCheckBox"
                                          Content="Launch Protes on Windows startup"
                                          Checked="LaunchOnStartupCheckBox_Checked"
                                          Unchecked="LaunchOnStartupCheckBox_Unchecked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="MinimizeToSystemTray"
                                          Content="Minimize to system tray instead of taskbar"
                                          Checked="MinimizeToSystemTray_Checked"
                                          Unchecked="MinimizeToSystemTray_Checked"
                                          Margin="0,5,0,0"/>
                                <!-- NEW SETTING -->
                                <CheckBox x:Name="CloseToSystemTray"
                                          Content="Close to system tray instead of exiting"
                                          Checked="CloseToSystemTray_Checked"
                                          Unchecked="CloseToSystemTray_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Grid.Row="1" Header="File Explorer &amp; Context Menu Integration" Margin="0,0,0,5">
                            <StackPanel>
                                <CheckBox x:Name="ShellNewCheckBox"
                                          Content="Add to Windows 'New' menu: 'Pro Note'"
                                          Checked="ShellNewCheckBox_Checked"
                                          Unchecked="ShellNewCheckBox_Unchecked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="SendToCheckBox"
                                          Content="Add to Windows 'Send to' menu: 'Protes (Import)'"
                                          Checked="SendToCheckBox_Checked"
                                          Unchecked="SendToCheckBox_Unchecked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="SendToNoteEditorCheckBox"
                                          Content="Add to Windows 'Send to' menu: 'Pro Note'"
                                          Checked="SendToNoteEditorCheckBox_Checked"
                                          Unchecked="SendToNoteEditorCheckBox_Unchecked"
                                          Margin="0,5,0,5"/>
                            </StackPanel>
                            
                        </GroupBox>

                        <!-- Auto Connect -->
                        <GroupBox Grid.Row="2" Header="Connection Automation" Margin="0,0,0,5">
                            <StackPanel>
                                <CheckBox x:Name="AutoConnectCheckBox"
                                          Content="Auto-Connect when program launches"
                                          Checked="AutoConnectCheckBox_Checked"
                                          Unchecked="AutoConnectCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="AutoConnectOnSwitchCheckBox"
                                          Content="Auto-Connect when switching database mode from options menu (ACOS)"
                                          Checked="AutoConnectOnSwitchCheckBox_Checked"
                                          Unchecked="AutoConnectOnSwitchCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="AutoDisconnectOnSwitchCheckBox"
                                          Content="Disconnect when switching database mode (options menu)"
                                          Checked="AutoDisconnectOnSwitchCheckBox_Checked"
                                          Unchecked="AutoDisconnectOnSwitchCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Grid.Row="3" Header="Notifications" Margin="0,0,0,5">
                            <StackPanel>
                                <CheckBox x:Name="ShowNotificationsCheckBox"
                                          Content="Show connected/disconnected notifications"
                                          Checked="ShowNotificationsCheckBox_Changed"
                                          Unchecked="ShowNotificationsCheckBox_Changed"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="NotifyDeletedCheckBox"
                                          Content="Show File(s) deleted successfully"
                                          Checked="NotifyDeletedCheckBox_Changed"
                                          Unchecked="NotifyDeletedCheckBox_Changed"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="NotifyCopiedCheckBox"
                                          Content="Show File(s) copied successfully"
                                          Checked="NotifyCopiedCheckBox_Changed"
                                          Unchecked="NotifyCopiedCheckBox_Changed"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="NotifyPastedCheckBox"
                                          Content="Show File(s) pasted successfully"
                                          Checked="NotifyPastedCheckBox_Changed"
                                          Unchecked="NotifyPastedCheckBox_Changed"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- ✅ MOVED HERE: Font group at the bottom of Application tab -->
                        <GroupBox Grid.Row="4" Header="Main Window Font" Margin="0,0,0,5">
                            <Button x:Name="MainWindowFontButton"
                                    Content="Datagrid Font..."
                                    HorizontalAlignment="Left"
                                    Style="{StaticResource ConsistentButtonStyle}"
                                    Click="MainWindowFontButton_Click"/>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- NEW TOOLBAR TAB -->
            <TabItem Header="Toolbar">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <GroupBox Grid.Row="0" Header="Toolbar Visibility" Margin="0,0,0,10">
                            <StackPanel>
                                <CheckBox x:Name="ViewToolbarMenuItem"
                                          Content="Show Toolbar"
                                          Checked="ViewToolbarMenuItem_Checked"
                                          Unchecked="ViewToolbarMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarOptionsInMenuCheckBox"
                                          Content="Toolbar Options Menu Shortcuts"
                                          Checked="ViewToolbarOptionsInMenuCheckBox_Checked"
                                          Unchecked="ViewToolbarOptionsInMenuCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Grid.Row="1" Header="Toolbar Icons" Margin="0,0,0,0">
                            <StackPanel>
                                <CheckBox x:Name="ViewToolbarConnectMenuItem"
                                          Content="Connect/Disconnect"
                                          Checked="ViewToolbarConnectMenuItem_Checked"
                                          Unchecked="ViewToolbarConnectMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarACOSMenuItem"
                                          Content="ACOS - Auto Connect on Switch (local/external)"
                                          Checked="ViewToolbarACOSMenuItem_Checked"
                                          Unchecked="ViewToolbarACOSMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarLocalDBMenuItem"
                                          Content="Local Databases - Dropdown menu and load icon"
                                          Checked="ViewToolbarLocalDBMenuItem_Checked"
                                          Unchecked="ViewToolbarLocalDBMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarImpExMenuItem"
                                          Content="Import/Export"
                                          Checked="ViewToolbarImpExMenuItem_Checked"
                                          Unchecked="ViewToolbarImpExMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarSearchMenuItem"
                                          Content="Search Database"
                                          Checked="ViewToolbarSearchMenuItem_Checked"
                                          Unchecked="ViewToolbarSearchMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <Button Grid.Row="1" Content="Close" HorizontalAlignment="Right" Padding="12,5" Click="CloseButton_Click"/>
    </Grid>
</Window>