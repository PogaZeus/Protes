<Window x:Class="Protes.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mr E Tools - [Protes] Pro Notes Database - Settings" 
        Height="680" Width="750"
        FontFamily="Segoe UI" 
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Reusable style for action buttons (hide when no selection) -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="1">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Tabs -->
        <TabControl x:Name="SettingsTabControl" Grid.Row="0" Margin="0,0,0,10">

            <!-- LOCAL DATABASE TAB -->
            <TabItem Header="Local Database">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Current Database -->
                        <GroupBox Grid.Row="0" Header="Current Database" Margin="0,0,0,15">
                            <TextBlock x:Name="CurrentDbPathText" Text="C:\Users\...\notes.db"
                                       TextWrapping="Wrap"
                                       FontStyle="Italic"/>
                        </GroupBox>

                        <!-- Actions -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,15">
                            <Button x:Name="NewDbButton" Content="New…" Padding="10,5" Margin="0,0,10,0" Click="NewDbButton_Click"/>
                            <Button x:Name="ExportDbButton" Content="Export…" Padding="10,5" Margin="0,0,10,0" Click="ExportDbButton_Click"/>
                            <Button x:Name="ImportDbButton" Content="Import…" Padding="10,5" Click="ImportDbButton_Click"/>
                        </StackPanel>

                        <!-- Available Databases List -->
                        <GroupBox Grid.Row="2" Header="Available Databases" Margin="0,0,0,15">
                            <ListBox x:Name="LocalDbList">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding FullPath}" FontStyle="Italic" FontSize="10" Foreground="Gray"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </GroupBox>

                        <!-- Action Buttons (Load, Remove, Delete) -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,15">
                            <Button x:Name="LoadSelectedButton"
                                    Content="Load Selected"
                                    Padding="10,5"
                                    Click="LoadSelectedButton_Click"
                                    Style="{StaticResource ActionButtonStyle}"/>
                            <Button x:Name="RemoveFromListButton"
                                    Content="Remove from List"
                                    Padding="10,5"
                                    Click="RemoveFromListButton_Click"
                                    Style="{StaticResource ActionButtonStyle}"
                                    Margin="10,0,0,0"/>
                            <Button x:Name="DeleteDatabaseButton"
                                    Content="Delete Database"
                                    Padding="10,5"
                                    Click="DeleteDatabaseButton_Click"
                                    Style="{StaticResource ActionButtonStyle}"
                                    Margin="10,0,0,0"/>
                        </StackPanel>

                        <TextBlock Grid.Row="4" Text="Note: Databases are stored in the Protes app data folder." 
                                   FontStyle="Italic" Foreground="Gray"/>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- EXTERNAL DATABASE TAB -->
            <TabItem Header="External Database">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Schema Requirements -->
                    <GroupBox Grid.Row="0" Header="Required Table Schema" Margin="0,0,0,20">
                        <TabControl>
                            <TabItem Header="Requirements">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Your external database must contain a table named:" FontWeight="Bold"/>
                                    <TextBlock Text="→ Notes" Margin="10,5" Foreground="Red"/>
                                    <TextBlock Text="With the following columns:" Margin="0,10,0,5" FontWeight="Bold"/>
                                    <TextBlock Text="• Id (INTEGER PRIMARY KEY)" Margin="10,0"/>
                                    <TextBlock Text="• Title (TEXT, NOT NULL)" Margin="10,0"/>
                                    <TextBlock Text="• Content (TEXT)" Margin="10,0"/>
                                    <TextBlock Text="• Tags (TEXT)" Margin="10,0"/>
                                    <TextBlock Text="• LastModified (TEXT in 'yyyy-MM-dd HH:mm' format)" Margin="10,0"/>
                                </StackPanel>
                            </TabItem>
                            <TabItem Header="Create Table (MySQL)">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <TextBox x:Name="CreateTableSqlBox"
                                             Text="CREATE TABLE Notes (&#x0a;    Id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,&#x0a;    Title VARCHAR(255) NOT NULL,&#x0a;    Content TEXT,&#x0a;    Tags VARCHAR(255),&#x0a;    LastModified DATETIME&#x0a;);"
                                             TextWrapping="NoWrap"
                                             AcceptsReturn="True"
                                             IsReadOnly="True"
                                             VerticalScrollBarVisibility="Auto"
                                             FontFamily="Consolas"
                                             FontSize="12"
                                             MinHeight="100"/>
                                    <Button Grid.Row="1" Content="Copy SQL" Width="80" Height="26" HorizontalAlignment="Left" Margin="0,10,0,0" Click="CopySqlButton_Click"/>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </GroupBox>

                    <!-- Connection Details -->
                    <GroupBox Grid.Row="1" Header="Connection Details" Margin="0,0,0,20">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Host:" Margin="0,5"/>
                            <TextBox x:Name="HostTextBox" Grid.Row="0" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" Margin="0,5"/>
                            <TextBox x:Name="PortTextBox" Grid.Row="1" Grid.Column="1" Margin="10,5" Height="26" Text="3306"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Database:" Margin="0,5"/>
                            <TextBox x:Name="DatabaseTextBox" Grid.Row="2" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Username:" Margin="0,5"/>
                            <TextBox x:Name="UsernameTextBox" Grid.Row="3" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Password:" Margin="0,5"/>
                            <PasswordBox x:Name="PasswordBox" Grid.Row="4" Grid.Column="1" Margin="10,5" Height="26"/>
                        </Grid>
                    </GroupBox>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Save Settings" Padding="12,5" Margin="0,0,10,0" Click="SaveExternalSettings_Click"/>
                        <Button Content="Connect Now" Padding="12,5" Click="ConnectNowButton_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- MORE OPTIONS TAB -->
            <TabItem Header="More Options">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Default Database Folder -->
                        <GroupBox Grid.Row="1" Header="Default Database Folder" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Name="DefaultDbFolderText"
                                           Text="C:\Users\...\AppData\Roaming\Protes"
                                           TextWrapping="Wrap"
                                           FontStyle="Italic"
                                           Margin="0,0,0,5"/>
                                <Button Grid.Row="1"
                                        Content="Change Folder…"
                                        Padding="8,3"
                                        HorizontalAlignment="Left"
                                        Click="ChangeDefaultFolderButton_Click"/>
                            </Grid>
                        </GroupBox>
                        
                        <!-- Auto Connect -->
                        <GroupBox Grid.Row="2" Header="Auto Connect" Margin="0,0,0,15">
                            <StackPanel>
                                <CheckBox x:Name="AutoConnectCheckBox"
                  Content="Connect on startup"
                  Checked="AutoConnectCheckBox_Checked"
                  Unchecked="AutoConnectCheckBox_Checked"/>
                                <CheckBox x:Name="AutoConnectOnSwitchCheckBox"
                  Content="Connect when switching database mode (options menu)"
                  Checked="AutoConnectOnSwitchCheckBox_Checked"
                  Unchecked="AutoConnectOnSwitchCheckBox_Checked"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Notifications -->
                        <GroupBox Grid.Row="3" Header="Notifications" Margin="0,0,0,15">
                            <CheckBox x:Name="ShowNotificationsCheckBox"
                                      Content="Show connect/disconnect notifications"
                                      Checked="ShowNotificationsCheckBox_Changed"
                                      Unchecked="ShowNotificationsCheckBox_Changed"/>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Bottom: Close button -->
        <Button Grid.Row="1" Content="Close" HorizontalAlignment="Right" Padding="12,5" Click="CloseButton_Click"/>
    </Grid>
</Window>