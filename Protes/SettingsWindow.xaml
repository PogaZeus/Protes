<Window x:Class="Protes.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Protes"
        Title="Mr E Tools - [Protes] Pro Notes Database - Settings" 
        Height="610" Width="500"
        MinWidth="500"
        MinHeight="615"
        FontFamily="Segoe UI" 
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Reusable style for action buttons -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="Height" Value="26"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ElementName=LocalDbList, Path=SelectedItems.Count}" Value="1">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Base button style for consistent height -->
        <Style x:Key="ConsistentButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Padding" Value="10,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl x:Name="SettingsTabControl" Grid.Row="0" Margin="0,0,0,5">

            <!-- LOCAL DATABASE TAB -->
            <TabItem Header="Local Database">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Available Databases (now fills space and includes buttons inside) -->
                        <GroupBox Grid.Row="0" Header="Available Databases" Margin="0,2,0,5">
                            <Grid Margin="0,5,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <ListBox x:Name="LocalDbList" 
                                         SelectionChanged="LocalDbList_SelectionChanged"
                                         VerticalContentAlignment="Stretch">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding FullPath}" FontStyle="Italic" FontSize="10" Foreground="Gray"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!-- Action buttons inside Available Databases box -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,5,0,0">
                                    <Button x:Name="LoadSelectedButton"
                                            Content=" Load Selected "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="LoadSelectedButton_Click"/>
                                    <Button x:Name="RemoveFromListButton"
                                            Content=" Remove from List "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="RemoveFromListButton_Click"/>
                                    <Button x:Name="DeleteDatabaseButton"
                                            Content=" Delete Database "
                                            Style="{StaticResource ActionButtonStyle}"
                                            Margin="0,0,10,0"
                                            Click="DeleteDatabaseButton_Click"/>
                                </StackPanel>
                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,5,0,0">
                                        <TextBlock 
           Text="Note: Database's stored inside the default folder cannot be removed from the list." 
           FontStyle="Italic" 
           Foreground="Gray"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                        
                        <!-- Current Database with buttons inside -->
                        <GroupBox Grid.Row="1" Header="Current Database" Margin="0,0,0,5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Name="CurrentDbPathText" 
                                           Text="C:\Users\...\notes.db"
                                           TextWrapping="Wrap"
                                           FontStyle="Italic"
                                           Margin="0,5,0,5"/>
                                <StackPanel Grid.Row="1" Orientation="Horizontal">
                                    <Button x:Name="NewDbButton" Content="New…" Style="{StaticResource ConsistentButtonStyle}" Margin="0,0,10,0" Click="NewDbButton_Click"/>
                                    <Button x:Name="ExportDbButton" Content="Export…" Style="{StaticResource ConsistentButtonStyle}" Margin="0,0,10,0" Click="ExportDbButton_Click"/>
                                    <Button x:Name="ImportDbButton" Content="Import…" Style="{StaticResource ConsistentButtonStyle}" Click="ImportDbButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Default Database Folder (now at bottom) -->
                        <GroupBox Grid.Row="2" Header="Default Database Folder" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Name="DefaultDbFolderText"
                                           Text="C:\Users\...\AppData\Roaming\Protes"
                                           TextWrapping="Wrap"
                                           FontStyle="Italic"
                                           Margin="0,5,0,5"/>
                                <Button Grid.Row="1"
                                        Content="Change Folder…"
                                        Style="{StaticResource ConsistentButtonStyle}"
                                        HorizontalAlignment="Left"
                                        Click="ChangeDefaultFolderButton_Click"/>
                            </Grid>
                        </GroupBox>

                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- EXTERNAL DATABASE TAB (unchanged) -->
            <TabItem Header="External Database">
                <Grid Margin="0,5,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <GroupBox Grid.Row="0" Header="Required Table Schema" Margin="5,0,5,5">
                        <TabControl Margin="0,5,0,0">
                            <TabItem Header="Requirements">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Your external database must contain a table named:" FontWeight="Bold"/>
                                    <TextBlock Text="→ Notes" Margin="10,5" Foreground="Red"/>
                                    <TextBlock Text="With the following columns:" Margin="0,10,0,5" FontWeight="Bold"/>
                                    <TextBlock Text="• Id (INTEGER PRIMARY KEY)" Margin="10,0"/>
                                    <TextBlock Text="• Title (TEXT, NOT NULL)" Margin="10,0"/>
                                    <TextBlock Text="• Content (TEXT)" Margin="10,0"/>
                                    <TextBlock Text="• Tags (TEXT)" Margin="10,0"/>
                                    <TextBlock Text="• LastModified (TEXT in 'yyyy-MM-dd HH:mm' format)" Margin="10,0"/>
                                </StackPanel>
                            </TabItem>
                            <TabItem Header="Create Table (MySQL)">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <TextBox x:Name="CreateTableSqlBox"
                                             Text="CREATE TABLE Notes (&#x0a;    Id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,&#x0a;    Title VARCHAR(255) NOT NULL,&#x0a;    Content TEXT,&#x0a;    Tags VARCHAR(255),&#x0a;    LastModified DATETIME&#x0a;);"
                                             TextWrapping="NoWrap"
                                             AcceptsReturn="True"
                                             IsReadOnly="True"
                                             VerticalScrollBarVisibility="Auto"
                                             FontFamily="Consolas"
                                             FontSize="12"
                                             MinHeight="100"/>
                                    <Button Grid.Row="1" Content="Copy SQL" Width="80" Height="26" HorizontalAlignment="Left" Margin="0,10,0,0" Click="CopySqlButton_Click"/>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </GroupBox>

                    <GroupBox Grid.Row="1" Header="Connection Details" Margin="5,0,5,5">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Host:" Margin="0,5"/>
                            <TextBox x:Name="HostTextBox" Grid.Row="0" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" Margin="0,5"/>
                            <TextBox x:Name="PortTextBox" Grid.Row="1" Grid.Column="1" Margin="10,5" Height="26" Text="3306"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Database:" Margin="0,5"/>
                            <TextBox x:Name="DatabaseTextBox" Grid.Row="2" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Username:" Margin="0,5"/>
                            <TextBox x:Name="UsernameTextBox" Grid.Row="3" Grid.Column="1" Margin="10,5" Height="26"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Password:" Margin="0,5"/>
                            <PasswordBox x:Name="PasswordBox" Grid.Row="4" Grid.Column="1" Margin="10,5" Height="26"/>
                        </Grid>
                    </GroupBox>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Save Settings" Padding="12,5" Margin="0,0,10,0" Click="SaveExternalSettings_Click"/>
                        <Button Content="Connect Now" Padding="12,5" Click="ConnectNowButton_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- MORE OPTIONS TAB -->
            <TabItem Header="More Options">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Auto Connect -->
                        <GroupBox Grid.Row="0" Header="Connection Automation" Margin="0,0,0,10">
                            <StackPanel>
                                <CheckBox x:Name="AutoConnectCheckBox"
                                          Content="Connect when program launches (AC-OL)"
                                          Checked="AutoConnectCheckBox_Checked"
                                          Unchecked="AutoConnectCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="AutoConnectOnSwitchCheckBox"
                                          Content="Connect when switching database mode (options menu) (AC-OS)"
                                          Checked="AutoConnectOnSwitchCheckBox_Checked"
                                          Unchecked="AutoConnectOnSwitchCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="AutoDisconnectOnSwitchCheckBox"
                                          Content="Disconnect when switching database mode (options menu)"
                                          Checked="AutoDisconnectOnSwitchCheckBox_Checked"
                                          Unchecked="AutoDisconnectOnSwitchCheckBox_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Notifications -->
                        <GroupBox Grid.Row="1" Header="Notifications" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="• [Off By Default]" Margin="0,5,0,5"/>
                                <CheckBox x:Name="ShowNotificationsCheckBox"
                  Content="Show connected/disconnected notifications"
                  Checked="ShowNotificationsCheckBox_Changed"
                  Unchecked="ShowNotificationsCheckBox_Changed"
                  Margin="0,0,0,0"/>
                                <CheckBox x:Name="NotifyDeletedCheckBox"
                  Content="Show File(s) deleted successfully"
                  Checked="NotifyDeletedCheckBox_Changed"
                  Unchecked="NotifyDeletedCheckBox_Changed"
                  Margin="0,5,0,0"/>

                                <CheckBox x:Name="NotifyCopiedCheckBox"
                  Content="Show File(s) copied successfully"
                  Checked="NotifyCopiedCheckBox_Changed"
                  Unchecked="NotifyCopiedCheckBox_Changed"
                  Margin="0,5,0,0"/>

                                <CheckBox x:Name="NotifyPastedCheckBox"
                  Content="Show File(s) pasted successfully"
                  Checked="NotifyPastedCheckBox_Changed"
                  Unchecked="NotifyPastedCheckBox_Changed"
                  Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- NEW: Toolbar Settings -->
                        <GroupBox Grid.Row="2" Header="Toolbar Settings" Margin="0,0,0,10">
                            <StackPanel>
                                <CheckBox x:Name="ViewToolbarMenuItem"
                                          Content="Show Toolbar"
                                          Checked="ViewToolbarMenuItem_Checked"
                                          Unchecked="ViewToolbarMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarOptionsInMenuCheckBox"
                                          Content="Show 'Toolbar Options' in Menu"
                                          Checked="ViewToolbarOptionsInMenuCheckBox_Checked"
                                          Unchecked="ViewToolbarOptionsInMenuCheckBox_Checked"
                                          Margin="0,5,0,5"/>
                                <TextBlock Text="• Toolbar Icons:" Margin="0,0"/>
                                <CheckBox x:Name="ViewToolbarConnectMenuItem"
                                          Content="Connect/Disconnect"
                                          Checked="ViewToolbarConnectMenuItem_Checked"
                                          Unchecked="ViewToolbarConnectMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarLocalDBMenuItem"
                                          Content="Local Databases - Dropdown menu and load icon"
                                          Checked="ViewToolbarLocalDBMenuItem_Checked"
                                          Unchecked="ViewToolbarLocalDBMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarACOLMenuItem"
                                          Content="AC-OL - Auto connect when program starts"
                                          Checked="ViewToolbarACOLMenuItem_Checked"
                                          Unchecked="ViewToolbarACOLMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                                <CheckBox x:Name="ViewToolbarACOSMenuItem"
                                          Content="AC-OS - Auto connect when switching database mode"
                                          Checked="ViewToolbarACOSMenuItem_Checked"
                                          Unchecked="ViewToolbarACOSMenuItem_Checked"
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        <GroupBox Grid.Row="3" Header="Application Settings" Margin="0,0,0,10">
                            <StackPanel>
                                <CheckBox x:Name="MinimizeToSystemTray"
           Content="Minimize to system tray instead of taskbar"
           Checked="MinimizeToSystemTray_Checked"
           Unchecked="MinimizeToSystemTray_Checked"
           Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <Button Grid.Row="1" Content="Close" HorizontalAlignment="Right" Padding="12,5" Click="CloseButton_Click"/>
    </Grid>
</Window>