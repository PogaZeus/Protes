<Window x:Class="Protes.Views.ExportFromDBWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="[Protes] Export File(s) from Database" 
        Height="550" Width="600"
        MinHeight="550" MinWidth="600"
        WindowStartupLocation="CenterOwner"
        FontFamily="Segoe UI"
        ResizeMode="CanResizeWithGrip">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Database Info -->
        <TextBlock x:Name="DatabaseInfoText" Text="Database: ..." FontSize="14" FontWeight="Bold" Margin="0,5,0,10"/>

        <!-- Output Folder Selection -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="SelectFolderButton" Content="Select Output Folder" 
                    Padding="10,5" Click="SelectFolderButton_Click" 
                    VerticalAlignment="Center"/>

            <TextBlock x:Name="SelectedFolderText" Grid.Column="1" 
                       Text="Selected folder: (none)" 
                       VerticalAlignment="Center" 
                       Margin="10,0,0,0"
                       TextTrimming="CharacterEllipsis"
                       ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
        </Grid>

        <!-- Export Data Grid -->
        <DataGrid Grid.Row="2" x:Name="ExportDataGrid"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserSortColumns="True"
                  SelectionUnit="FullRow"
                  HeadersVisibility="Column">
            <DataGrid.Columns>
                <!-- Checkbox Column -->
                <DataGridTemplateColumn Header="Select All" Width="50">
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=DataContext.AllItemsAreChecked, Mode=TwoWay}"
                                      HorizontalAlignment="Center" VerticalAlignment="Center" Margin="11,0" />
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="2*"/>
                <DataGridTextColumn Header="Modified" Binding="{Binding LastModified}" Width="1*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Export Controls -->
        <Grid Grid.Row="3" Margin="0,10,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Format Selection -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Export Format:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <ComboBox x:Name="ExportFormatComboBox" SelectedIndex="0" SelectionChanged="ExportFormatComboBox_SelectionChanged">
                    <ComboBoxItem Content="*.CSV"/>
                    <ComboBoxItem Content="*.TXT"/>
                    <ComboBoxItem Content="*.MD"/>
                </ComboBox>
            </StackPanel>

            <!-- Filename (only for CSV) -->
            <StackPanel x:Name="CsvFilenamePanel" Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,8,0,0">
                <TextBlock Text="Filename:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox x:Name="CsvFilenameTextBox" Width="200" Height="26" Text="export.csv"/>
                <TextBlock Text=".csv" VerticalAlignment="Center" Margin="8,0,0,0"/>
            </StackPanel>

            <!-- Info Note -->
            <TextBlock x:Name="InfoNoteText" Grid.Row="2" 
                       FontStyle="Italic" Foreground="Gray" Margin="0,8,0,0"
                       TextWrapping="Wrap">
                <Run>This will export the selected entries into 1 CSV file.</Run>
                <LineBreak/>
                <Run>Delimiter: Comma | Text Delimiter: Double quotes | Character set: Unicode (UTF-8)</Run>
            </TextBlock>

            <!-- Buttons -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                <Button Content="Cancel" Padding="12,5" Click="CancelButton_Click" Margin="0,0,10,0"/>
                <Button x:Name="ExportButton" Content="Export" Padding="12,5" Click="ExportButton_Click"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>