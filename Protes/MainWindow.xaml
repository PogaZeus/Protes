<Window x:Class="Protes.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mr E Tools - [Protes] Pro Notes Database" 
        WindowState="Maximized"
        FontFamily="Segoe UI" WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Menu -->
            <RowDefinition Height="Auto"/>
            <!-- Icon Tray + Actions + Search -->
            <RowDefinition Height="*"/>
            <!-- Notes Table -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- === MENU BAR === -->
        <Menu Grid.Row="0" x:Name="MainMenu">
            <MenuItem Header="_File">
                <!-- NEW: Note actions -->
                <MenuItem x:Name="NewNoteMenuItem" Header="_New" Click="NewNoteButton_Click"/>
                <MenuItem x:Name="EditNoteMenuItem" Header="_Edit" Click="EditNoteButton_Click"/>
                <MenuItem x:Name="DeleteNoteMenuItem" Header="_Delete" Click="DeleteNoteButton_Click"/>
                <Separator/>
                <MenuItem Header="_Connect" Click="Connect_Click"/>
                <MenuItem Header="_Disconnect" Click="Disconnect_Click"/>
                <Separator/>
                <MenuItem Header="_Quit" Click="Quit_Click"/>
            </MenuItem>

            <MenuItem Header="_Options" Name="OptionsMenu">
                <MenuItem Header="Local Database" Click="UseLocalDb_Click" IsCheckable="True"/>
                <MenuItem Header="External Database" Click="UseExternalDb_Click" IsCheckable="True"/>
                <Separator/>
                <MenuItem Header="_Settings" Click="OpenSettings_Click"/>
            </MenuItem>

            <!-- NEW: View Menu -->
            <MenuItem Header="_View">
                <MenuItem x:Name="ViewTitleMenuItem" Header="Title" IsCheckable="True" Checked="ViewTitleMenuItem_Checked" Unchecked="ViewTitleMenuItem_Checked"/>
                <MenuItem x:Name="ViewTagsMenuItem" Header="Tags" IsCheckable="True" Checked="ViewTagsMenuItem_Checked" Unchecked="ViewTagsMenuItem_Checked"/>
                <MenuItem x:Name="ViewModifiedMenuItem" Header="Modified" IsCheckable="True" Checked="ViewModifiedMenuItem_Checked" Unchecked="ViewModifiedMenuItem_Checked"/>
                <Separator/>
                <MenuItem Header="_Zoom">
                    <MenuItem Header="Zoom _In" Click="ZoomInMenuItem_Click" InputGestureText="Ctrl+Plus"/>
                    <MenuItem Header="Zoom _Out" Click="ZoomOutMenuItem_Click" InputGestureText="Ctrl+Minus"/>
                    <MenuItem Header="_Restore Zoom" Click="RestoreZoomMenuItem_Click" InputGestureText="Ctrl+0"/>
                </MenuItem>
                <Separator/>
                <MenuItem x:Name="ViewToolbarMenuItem" Header="Show Toolbar" IsCheckable="True" Checked="ViewToolbarMenuItem_Checked" Unchecked="ViewToolbarMenuItem_Checked"/>
                <MenuItem Header="Toolbar Options">
                    <MenuItem x:Name="ViewToolbarConnectMenuItem" Header="Connect and Disconnect" IsCheckable="True" Checked="ViewToolbarConnectMenuItem_Checked" Unchecked="ViewToolbarConnectMenuItem_Checked"/>
                    <MenuItem x:Name="ViewToolbarACOLMenuItem" Header="(Auto) Connect On Launch" IsCheckable="True" Checked="ViewToolbarACOLMenuItem_Checked" Unchecked="ViewToolbarACOLMenuItem_Checked"/>
                    <MenuItem x:Name="ViewToolbarACOSMenuItem" Header="(Auto) Connect On Switch" IsCheckable="True" Checked="ViewToolbarACOSMenuItem_Checked" Unchecked="ViewToolbarACOSMenuItem_Checked"/>
                    <MenuItem x:Name="ViewToolbarLocalDBMenuItem" Header="Local Databases" IsCheckable="True" Checked="ViewToolbarLocalDBMenuItem_Checked" Unchecked="ViewToolbarLocalDBMenuItem_Checked"/>
                </MenuItem>
            </MenuItem>

            <!-- Info Menu -->
            <MenuItem Header="_Info">
                <MenuItem Header="_About" Click="AboutMenuItem_Click"/>
            </MenuItem>
        </Menu>

        <!-- === ICON TRAY + NOTE ACTIONS + SEARCH === -->
        <StackPanel x:Name="ToolbarStackPanel" Grid.Row="1" Orientation="Horizontal" Margin="10,5"
            HorizontalAlignment="Left" VerticalAlignment="Top">
            <!-- Connection & Settings Icons -->
            <StackPanel x:Name="ViewToolbarConnectainer" Orientation="Horizontal" VerticalAlignment="Center">
            <Button x:Name="ConnectIconBtn" Content="🔌" FontSize="16" Width="32" Height="32"
        ToolTip="Connect" Click="Connect_Click" Margin="0,0,8,0"/>
            <Button x:Name="DisconnectIconBtn" Content="🚫" FontSize="16" Width="32" Height="32"
        ToolTip="Disconnect" Click="Disconnect_Click" Margin="0,0,12,0"/>
            </StackPanel>

            <Border x:Name="AutoConnectOSContainer">
                <CheckBox x:Name="AutoConnectOnSwitchCheckBox" x:Uid="AutoConnectOnSwitchCheckBox"
  Content="AC-OS" 
  VerticalAlignment="Center"
  Checked="AutoConnectOnSwitchCheckBox_Checked"
  Unchecked="AutoConnectOnSwitchCheckBox_Checked" Margin="0,0,8,0"/>
            </Border>
            <Border x:Name="AutoConnectOLContainer">
                <CheckBox x:Name="AutoConnectCheckBox" x:Uid="AutoConnectCheckBox"
  Content="AC-OL" 
  VerticalAlignment="Center"
  Checked="AutoConnectCheckBox_Checked"
  Unchecked="AutoConnectCheckBox_Checked" Margin="0,0,12,0"/>
            </Border>

            <!-- Separator -->
            <Rectangle Fill="Gray" Width="1" Height="24" Margin="0,0,12,0" Opacity="0.6"/>

            <Button x:Name="SettingsIconBtn" Content="⚙️" FontSize="16" Width="32" Height="32"
            ToolTip="Settings" Click="OpenSettings_Click" Margin="0,0,8,0"/>

            <!-- Local Databases Group -->
            <StackPanel x:Name="LocalDbControls" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Local:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <ComboBox x:Name="AvailableDatabasesComboBox" MinWidth="150" Margin="0,0,8,0" VerticalContentAlignment="Center" Height="28"
              DisplayMemberPath="FileName" SelectedValuePath="FullPath"/>
                <Button x:Name="LoadSelectedDbButton" Content="↻" FontSize="16" Width="32" Height="32"
            ToolTip="Load Selected Database" Click="LoadSelectedDbButton_Click" Margin="0,0,12,0"/>
            </StackPanel>
            
            <!-- Separator -->
            <Rectangle Fill="Gray" Width="1" Height="24" Margin="0,0,12,0" Opacity="0.6"/>

            <Button x:Name="NewNoteButton" Content="➕" Padding="6,5"
            FontSize="16" Click="NewNoteButton_Click" Margin="0,0,8,0" ToolTip="New"/>
            <Button x:Name="EditNoteButton" Content="🖊️" Padding="6,5"
            FontSize="16" Click="EditNoteButton_Click" Margin="0,0,8,0" ToolTip="Edit"/>
            <Button x:Name="SelectNotesButton" Content="✅" Padding="6,5"
            FontSize="16" Click="SelectNotesButton_Click" Margin="0,0,8,0" ToolTip="Select"/>
            <Button x:Name="DeleteNoteButton" Content="🗑️" Padding="6,5"
            FontSize="16" Click="DeleteNoteButton_Click" Margin="0,0,8,0" ToolTip="Delete"/>
            <!-- Separator -->
            <Rectangle Fill="Gray" Width="1" Height="24" Margin="0,0,12,0" Opacity="0.6"/>

            <!-- 👇 NEW: Search with dropdown -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Search:" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,8,0"/>
                <ComboBox x:Name="SearchFieldComboBox" SelectedIndex="0" Height="28" Width="100" VerticalContentAlignment="Center" Margin="0,0,8,0">
                    <ComboBoxItem Content="All"/>
                    <ComboBoxItem Content="Title"/>
                    <ComboBoxItem Content="Content"/>
                    <ComboBoxItem Content="Tags"/>
                    <ComboBoxItem Content="Modified"/>
                </ComboBox>
                <TextBox x:Name="SearchBox" Width="200" Height="28"
                 VerticalContentAlignment="Center"
                 TextChanged="SearchBox_TextChanged"
                 VerticalAlignment="Center" Margin="0,0,8,0"/>
            </StackPanel>
        </StackPanel>

        <!-- === NOTES TABLE (DATA GRID) === -->

        <DataGrid Grid.Row="2" x:Name="NotesDataGrid" 
          PreviewMouseDown="NotesDataGrid_PreviewMouseDown" 
          Margin="5"
          AutoGenerateColumns="False"
          IsReadOnly="False"    
          CanUserAddRows="False" 
          SelectionMode="Extended"
          SelectionUnit="FullRow"
          Visibility="Collapsed"
          BeginningEdit="NotesDataGrid_BeginningEdit"
          CellEditEnding="NotesDataGrid_CellEditEnding"
          MouseDoubleClick="NotesDataGrid_MouseDoubleClick">
            <DataGrid.Columns>
                
                <!-- Checkbox Column -->
                <DataGridTemplateColumn 
    x:Name="SelectCheckBoxColumn"
    Width="40"
                    CanUserResize="False"
    Visibility="Collapsed">
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <CheckBox 
    IsChecked="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=DataContext.AllItemsAreChecked, Mode=TwoWay}"
    HorizontalAlignment="Center"
    VerticalAlignment="Center"
    Margin="6,0"
    Focusable="True"
    IsHitTestVisible="True" />
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Title" Binding="{Binding Title, UpdateSourceTrigger=PropertyChanged}" Width="1*"/>
                <DataGridTextColumn Header="Preview" Binding="{Binding Preview}" IsReadOnly="True" Width="3*"/>
                <DataGridTextColumn Header="Tags" Binding="{Binding Tags, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                <DataGridTextColumn Header="Modified" Binding="{Binding LastModified}" IsReadOnly="True" Width="120"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Placeholder when disconnected -->
        <TextBlock Grid.Row="2" x:Name="DisconnectedPlaceholder"
                   Text="Not connected to a database. Choose 'Local' or 'External Database' from Options."
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="16" Foreground="Gray" TextWrapping="Wrap" Margin="20"/>

        <!-- === STATUS BAR === -->
        <StatusBar Grid.Row="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <!-- Left: fixed content -->
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <!-- Spacer between mode and switch text -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Switch text (optional message) -->
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <!-- Spacer before note count -->
                    <ColumnDefinition Width="*"/>
                    <!-- Note count -->
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Connection Status -->
                <TextBlock x:Name="ConnectionStatusText" Text="Disconnected"/>

                <!-- Separator -->
                <Separator Grid.Column="1" Style="{StaticResource {x:Static StatusBar.SeparatorStyleKey}}" Margin="8,0"/>

                <!-- Database Mode (connected mode) -->
                <TextBlock x:Name="DatabaseModeText" Grid.Column="2" Text="—"/>

                <!-- Separator -->
                <Separator Grid.Column="3" Style="{StaticResource {x:Static StatusBar.SeparatorStyleKey}}" Margin="8,0"/>

                <!-- Pending Switch Message -->
                <TextBlock x:Name="DatabaseSwitchText" Grid.Column="4" Text="—"/>

                <!-- Separator -->
                <Separator Grid.Column="5" Style="{StaticResource {x:Static StatusBar.SeparatorStyleKey}}" Margin="8,0,8,0"/>

                <!-- Flexible spacer (pushes count to right) -->
                <Grid Grid.Column="6"/>

                <!-- Note Count -->
                <TextBlock x:Name="NoteCountText" Grid.Column="7" Text="0 Notes"/>

                <!-- Separator -->
                <Separator Grid.Column="8" Style="{StaticResource {x:Static StatusBar.SeparatorStyleKey}}" Margin="8,0"/>

                <!-- Empty placeholder (to match visual balance) -->
                <TextBlock Grid.Column="9" Text="" Visibility="Hidden"/>
            </Grid>
        </StatusBar>
    </Grid>
</Window>